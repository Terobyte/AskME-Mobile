# üõ†Ô∏è –ñ—É—Ä–Ω–∞–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—é –ø–æ–∏—Å–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä–æ–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–æ—Å—å –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ, –∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω –æ—Å—Ç–∞–≤–∞–ª—Å—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º (–≤–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞).

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –¥–ª–∏–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞—Ö (10+ —Å–µ–∫—É–Ω–¥), –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö streaming TTS —Å cross-fade (–ø–ª–∞–≤–Ω—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º), –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–Ω–µ–∑–∞–ø–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–æ—Å—å. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∫–∞–∑—ã–≤–∞–ª –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏, –º–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –≤–∫–ª—é—á–∞–ª—Å—è.

## üï∞Ô∏è –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –®–∞–≥ 1: Deadlock –≤ Mock Sound (v1)
**–§–∞–π–ª:** `src/services/tts-service.ts`
*   **–°–∏–º–ø—Ç–æ–º:** `prepareAudio` –∑–∞–ø—É—Å–∫–∞–ª streaming —Å—Ä–∞–∑—É, —Å–æ–∑–¥–∞–≤–∞—è deadlock.
*   **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 
    1.  –û—Ç–ª–æ–∂–∏–ª–∏ –∑–∞–ø—É—Å–∫ streaming –¥–æ –≤—ã–∑–æ–≤–∞ `playAsync`.
    2.  –ó–∞–º–µ–Ω–∏–ª–∏ `setInterval` –Ω–∞ –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ callback-—Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ –∑–∞–º—ã–∫–∞–Ω–∏–µ (closure), —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤ `didJustFinish` –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

### –®–∞–≥ 2: –û—à–∏–±–∫–∞ —Ä–µ–∫—É—Ä—Å–∏–∏ Promise (v2)
**–§–∞–π–ª:** `src/services/streaming-audio-player.ts`
*   **–°–∏–º–ø—Ç–æ–º:** –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º–æ–≥–ª–æ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏.
*   **–ü—Ä–∏—á–∏–Ω–∞:** –ë–ª–æ–∫ `finally` –æ–±–Ω—É–ª—è–ª `playCurrentPromise` *—Å—Ä–∞–∑—É* –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —á–∞–Ω–∫–∞, —É–¥–∞–ª—è—è –∞–∫—Ç–∏–≤–Ω—ã–π promise.
*   **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü–µ—Ä–µ–Ω–µ—Å–ª–∏ –æ–±–Ω—É–ª–µ–Ω–∏–µ `playCurrentPromise` **–¥–æ** —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `this.playCurrent()`, —É–±—Ä–∞–≤ –±–ª–æ–∫ `finally`.

### –®–∞–≥ 3: –î–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤ playAsync (v3)
**–§–∞–π–ª:** `src/services/streaming-audio-player.ts`
*   **–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏.
*   **–ü—Ä–∏—á–∏–Ω–∞:** Cross-fade –∑–∞–ø—É—Å–∫–∞–ª —Å–ª–µ–¥—É—é—â–∏–π —á–∞–Ω–∫, –∞ –∑–∞—Ç–µ–º –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏ —Å–Ω–æ–≤–∞ –ø—ã—Ç–∞–ª–∞—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ `playAsync`.
*   **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `getStatusAsync` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `playAsync`. –ï—Å–ª–∏ —á–∞–Ω–∫ —É–∂–µ –∏–≥—Ä–∞–µ—Ç (–∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ cross-fade), –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.

### –®–∞–≥ 4: –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–ø—É—Å–∫ —Å–æ–±—ã—Ç–∏—è (v4)
**–§–∞–π–ª:** `src/services/streaming-audio-player.ts`
*   **–ì–∏–ø–æ—Ç–µ–∑–∞:** –ú—ã –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (`didJustFinish`) –∏–∑-–∑–∞ —Ñ–ª–∞–≥–∞ `_isTransitioning`.
*   **–ü–æ–ø—ã—Ç–∫–∞:** –ò–∑–º–µ–Ω–∏–ª–∏ —É—Å–ª–æ–≤–∏—è –ø—Ä–æ–ø—É—Å–∫–∞ —Å–æ–±—ã—Ç–∏—è.
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ù–µ –ø–æ–º–æ–≥–ª–æ. –¢–∞–π–º-–∞—É—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª.

### –®–∞–≥ 5: –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (v5 - –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞)
**–§–∞–π–ª:** `src/services/streaming-audio-player.ts`
*   **–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –°–æ–±—ã—Ç–∏–µ `didJustFinish` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑**.
    1.  –ß–∞–Ω–∫ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è **–≤–æ –≤—Ä–µ–º—è** cross-fade.
    2.  –ú—ã –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ, —Ç–∞–∫ –∫–∞–∫ –ø–µ—Ä–µ—Ö–æ–¥ –∞–∫—Ç–∏–≤–µ–Ω.
    3.  Cross-fade –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –Ω–æ —Å–æ–±—ã—Ç–∏–µ –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–∏–¥–µ—Ç. –í—Å—ë –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.
*   **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í—Ä—É—á–Ω—É—é –≤—ã–∑—ã–≤–∞–µ–º –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —á–∞–Ω–∫—É (`this.currentIndex++`, `this.playCurrent()`) **—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è cross-fade** (–≤–Ω—É—Ç—Ä–∏ `setTimeout`).

## üìä –ò—Ç–æ–≥ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
–õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Ç–µ–ø–µ—Ä—å –Ω–∞–¥–µ–∂–Ω–∞. –ú—ã –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è–µ–º –æ—á–µ—Ä–µ–¥—å—é –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—Ä–æ—Å—Å-—Ñ–µ–π–¥–∞, –Ω–µ –ø–æ–ª–∞–≥–∞—è—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ã.

---
**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ—Ç–∏–ª, —á—Ç–æ "–º—ã –Ω–µ —Å–æ –≤—Å–µ–º –∑–∞–∫–æ–Ω—á–∏–ª–∏". –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—Å—É–¥–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã (–≤–æ–∑–º–æ–∂–Ω–æ, —Ç—é–Ω–∏–Ω–≥ —Ç–∞–π–º–∏–Ω–≥–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—É–∑ –∏–ª–∏ UX).
